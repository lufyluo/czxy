<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.czxy.manage.dao.ClassMapper">
    <sql id="base_column">
               id
        ,name
        ,address_id as addressId
        ,org_id as orgId
        ,begin_time as beginTime
        ,end_time as endTime
        ,arrange_id as arrangeId
        updated_time as updatedTime, created_time as createdTime
    </sql>
    <delete id="delete">
        delete from class where id = #{id}
    </delete>

    <select id="queryAll" resultType="com.czxy.manage.model.entity.ClassOrgEntity">
        select
         c.id
        ,c.name
        ,c.address_id as addressId
        ,c.org_id as orgId
        ,c.begin_time as beginTime
        ,c.end_time as endTime
        ,c.arrange_id as arrangeId
        ,c.updated_time as updatedTime, c.created_time as createdTime
        ,org.name as orgName
        ,u.name as masterName
        ,u1.name as leaderName
        from class c
        left join org o
        on c.org_id = org.id
        left join class_master cm
        on c.id = cm.class_id and cm.type =
        left join user u
        on cm.user_id = u.id
        left join student s
        on s.class_id = c.id and s.type = 8
        left join user u1
        on s.user_id = u1.id
        where name like '%${param}%' or org_name like '%${param}%' or u.name like '%${param}%'
    </select>
    <select id="query" resultType="com.czxy.manage.model.entity.ClassInformationEntity">
        select
        c.id,
        c.name,
        c.address_id as addressId,
        c.org_id as orgId,
        c.begin_time as beginTime,
        c.end_time as endTime,
        c.arrange_id as arrangeId,
        c.recommend_org_id as recommendOrgId,
        c.composition_id as compositionId,
        c.updated_time as updatedTime,
        c.created_time as createdTime,
        c.topics,
        c.duration as duration,
        o.name as orgName,
        a.name as addressName,
        u.name as masterName,
        ul.name as leaderName,
        og.name as recommendOrgName
        from class c
        left join org o
        on c.org_id = o.id
        left join address a
        on c.address_id = a.id
        left join class_master cm
        on c.id = cm.class_id
        left join user u
        on cm.user_id = u.id
        left join student s
        on  s.class_id = c.id and s.type = 8
        left join user ul
        on ul.id = s.user_id
        left join org og
        on c.recommend_org_id = og.id
    </select>
    <select id="queryAllStudent" resultType="com.czxy.manage.model.entity.ClassStudentEntity">
        select
        u.id as userId,
        u.name as userName,
        u.idcard as userIdCard,
        u.phone as userPhone,
        u.gender as userGender,
        u.position as userPosition,
        u.age as userAge,
        u.birthday as userBirthday,
        u.category as userCategory,
        u.wechat_id as userWechatId,
        u.updated_time as updatedTime,
        u.created_time as createdTime,
        u.org_id as userOrgId,
        u.nation as userNation,
        u.nativeplace as userNativeplace,
        cm.user_id as classMasterUserId,
        s.type as StudentType
        from class c
        left join class_master cm
        on c.id = cm.class_id
        left join user u
        on cm.user_id = u.id
        left join student s
        on c.id = s.class_id
    </select>
</mapper>